import requests
from bs4 import BeautifulSoup
import webbrowser
import os

# Set the URL to start with
START_URL = 'https://www.piaotia.com/html/6/6022/3885105.html'  # Replace with your specific URL

def fetch_and_clean_content(url):
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
    }
    response = requests.get(url, headers=headers)
    soup = BeautifulSoup(response.content, 'html.parser')
    
    # Remove unwanted elements
    for ad in soup.select('ads, .ad, .advertisement'):
        ad.decompose()
    
    content = soup.get_text()
    next_page = soup.find('a', text='下一章')
    
    next_page_url = next_page['href'] if next_page else None
    
    return content, next_page_url

def save_and_open_html(content, next_page_url):
    html_template = f"""
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Reading Mode</title>
        <style>
            body {{
                font-family: Arial, sans-serif;
                margin: 20px;
            }}
            #content {{
                white-space: pre-wrap;
            }}
        </style>
    </head>
    <body>
        <div id="content">{content}</div>
        <script>
            let nextPageUrl = '{next_page_url}';
            
            document.addEventListener('keydown', function(event) {{
                if (event.key === 'ArrowRight' && nextPageUrl) {{
                    window.location.href = nextPageUrl;
                }}
            }});
        </script>
    </body>
    </html>
    """

    with open("content.html", "w", encoding="utf-8") as file:
        file.write(html_template)
    
    webbrowser.open("file://" + os.path.abspath("content.html"))

if __name__ == '__main__':
    content, next_page_url = fetch_and_clean_content(START_URL)
    save_and_open_html(content, next_page_url)